# Generador de Estados NgRx

Este generador crea automáticamente toda la estructura NgRx para una nueva entidad en la librería de estados (@cpark/state), incluyendo pruebas y modelos opcionales.

## Uso

```bash
nx generate @chesspark/custom-generators:create-ngrx-state
```

## Opciones

- `name`: Nombre de la entidad (ej: puzzles, games, moves)
- `entityType`: Tipo de entidad
  - `list`: Para entidades que son listas (ej: puzzles, games, moves, tactics)
  - `single`: Para entidades individuales (ej: player, analysis, settings)
- `description`: Descripción opcional de la entidad
- `hasEffects`: Si incluir efectos para llamadas a API (por defecto: true)
- `hasFacade`: Si incluir facade service (por defecto: true)
- `hasTests`: Si incluir estructura básica de pruebas (por defecto: true)
- `createModel`: Si crear modelo en la librería de modelos (por defecto: false)

## Ejemplos

### Crear estado para puzzles (lista) con pruebas y modelo
```bash
nx generate @chesspark/custom-generators:create-ngrx-state puzzles --entityType=list --description="Puzzles de ajedrez" --hasTests=true --createModel=true
```

### Crear estado para jugador (individual) solo con pruebas
```bash
nx generate @chesspark/custom-generators:create-ngrx-state player --entityType=single --description="Información del jugador" --hasTests=true --createModel=false
```

### Crear estado para partidas (lista) sin facades
```bash
nx generate @chesspark/custom-generators:create-ngrx-state games --entityType=list --description="Historial de partidas" --hasTests=true --hasFacade=false
```

## Archivos Generados

Para una entidad llamada `puzzles` de tipo `list`, se generarán:

### Estructura por Entidades (Nueva)
```
libs/state/src/lib/
├── puzzles/                    # Directorio de la entidad
│   ├── index.ts             # Exportaciones de la entidad
│   ├── puzzles.state.ts       # Interfaz del estado
│   ├── puzzles.actions.ts     # Acciones (load, add, update, delete)
│   ├── puzzles.reducer.ts     # Reducer con lógica de estado
│   ├── puzzles.effects.ts     # Efectos para llamadas a API
│   ├── puzzles-facade.service.ts # Servicio facade
│   └── puzzles.selectors.ts   # Selectores
```

### Archivos de Pruebas (si hasTests=true)
**Ubicación**: `libs/state/src/tests/puzzles/`
```
tests/puzzles/
├── index.ts                 # Exportaciones de pruebas
├── puzzles.state.spec.ts      # Pruebas del estado
├── puzzles.actions.spec.ts    # Pruebas de acciones
├── puzzles.reducer.spec.ts    # Pruebas del reducer
├── puzzles.selectors.spec.ts  # Pruebas de selectores
├── puzzles.effects.spec.ts    # Pruebas de efectos (solo si hasEffects=true)
└── puzzles-facade.service.spec.ts # Pruebas del facade (solo si hasFacade=true)
```

### Archivos de Modelos (si createModel=true)
- `libs/models/src/puzzles/puzzles.models.ts` - Interfaces del modelo
- Actualización automática de `libs/models/src/index.ts`

## Estructura de Pruebas

### Ubicación por Entidades
Las pruebas se generan en `libs/state/src/tests/{entidad}/` siguiendo la nueva estructura organizada por entidades:
```
tests/
├── puzzles/                   # Pruebas de la entidad puzzles
│   ├── index.ts
│   ├── puzzles.state.spec.ts
│   ├── puzzles.actions.spec.ts
│   ├── puzzles.reducer.spec.ts
│   ├── puzzles.selectors.spec.ts
│   ├── puzzles.effects.spec.ts
│   └── puzzles-facade.service.spec.ts
├── games/                   # Pruebas de la entidad games
│   ├── index.ts
│   ├── games.state.spec.ts
│   └── ...
└── ui/                      # Pruebas de la entidad ui
    ├── index.ts
    ├── ui.state.spec.ts
    └── ...
```

### Entidades de Lista
- Pruebas para todas las acciones (load, add, update, delete)
- Pruebas del reducer con arrays
- Pruebas de selectores con múltiples elementos
- Pruebas del facade con operaciones CRUD completas

### Entidades Individuales
- Pruebas para acciones básicas (load, update)
- Pruebas del reducer con datos individuales
- Pruebas de selectores con un solo elemento
- Pruebas del facade con operaciones limitadas

### Importaciones Inteligentes
- Si `createModel=true`: Importa desde `@cpark/models`
- Si `createModel=false`: Define interfaces temporales con TODO para importar cuando se cree el modelo

## Integración Automática

El generador actualiza automáticamente:
- `libs/state/src/index.ts` - Agrega la exportación de la nueva entidad
- `libs/models/src/index.ts` - Exporta nuevos modelos (si createModel=true)

## Archivos Index.ts

### Para la Entidad
Se genera automáticamente `libs/state/src/lib/{entidad}/index.ts` con todas las exportaciones:
```typescript
// {EntityName} State Management
// Generated by @create-ngrx-state generator

// State
export * from './{entidad}.state';

// Actions
export * from './{entidad}.actions';

// Reducer
export * from './{entidad}.reducer';

// Selectors
export * from './{entidad}.selectors';

// Effects (solo si hasEffects=true)
export * from './{entidad}.effects';

// Facade Service (solo si hasFacade=true)
export * from './{entidad}-facade.service';
```

### Para las Pruebas
Se genera automáticamente `libs/state/src/tests/{entidad}/index.ts` con todas las exportaciones de pruebas.

## Personalización

Después de generar, puedes personalizar:
- Los tipos de datos en el estado y modelos
- Las acciones específicas que necesites
- La lógica del reducer
- Los efectos para tus servicios reales
- Los selectores según tus necesidades
- Las pruebas para casos específicos de tu negocio

## Notas de Pruebas

- Las pruebas usan Jest como framework de testing
- Incluyen mocks básicos para NgRx Store
- Están configuradas para trabajar con Angular Testing Module
- Son un punto de partida que puedes expandir según tus necesidades
- Las importaciones se adaptan automáticamente según las opciones elegidas

## Generación Condicional

- **Pruebas de efectos**: Solo se generan si `hasEffects=true`
- **Pruebas de facade**: Solo se generan si `hasFacade=true`
- **Modelos**: Solo se generan si `createModel=true`
- **Todas las pruebas**: Solo se generan si `hasTests=true`
